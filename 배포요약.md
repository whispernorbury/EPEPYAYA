# 🚀 프로덕션 배포 전 필수 작업 요약

## 📋 핵심 체크리스트 (5분 안에 확인)

### 1️⃣ 환경 변수 설정 (필수)

```bash
# 1. 템플릿 복사
cp env.production.example .env

# 2. .env 파일 편집 - 다음 값들을 반드시 변경:
```

**변경 필수 항목:**
- `OPENAI_API_KEY` → 실제 OpenAI API 키
- `MOCK_MODE=false` → 프로덕션에서는 반드시 false
- `REDIS_PASSWORD` → 강력한 비밀번호 설정
- `REDIS_URL` → 비밀번호 포함한 Redis URL

---

### 2️⃣ docker-compose.yml 확인 (필수)

**프로덕션 배포 시:**
- `docker-compose.yml`의 `MOCK_MODE=true` 제거하거나
- **권장:** `docker-compose.prod.yml` 사용

```bash
docker-compose -f docker-compose.prod.yml up -d
```

---

### 3️⃣ Redis 보안 설정 (필수)

`docker-compose.prod.yml` 사용 시 자동으로 비밀번호가 설정됩니다.
`.env` 파일에 `REDIS_PASSWORD`를 설정하세요.

---

### 4️⃣ 배포 실행

```bash
# 프로덕션 배포
docker-compose -f docker-compose.prod.yml up -d

# 로그 확인
docker-compose logs -f server

# Health check
curl http://localhost:3000/health
```

---

## 🔑 필수 환경 변수

| 변수명 | 설명 | 예시 | 필수 |
|--------|------|------|------|
| `OPENAI_API_KEY` | OpenAI API 키 | `sk-...` | ✅ |
| `MOCK_MODE` | 모의 모드 | `false` (프로덕션) | ✅ |
| `REDIS_PASSWORD` | Redis 비밀번호 | `strong-password-123` | ✅ |
| `REDIS_URL` | Redis 연결 URL | `redis://:password@redis:6379` | ✅ |
| `PORT` | 서버 포트 | `3000` | ⚠️ |
| `MIN_SCORE_THRESHOLD` | 최소 유사도 | `0.75` | ⚠️ |
| `CACHE_TTL_SECONDS` | 캐시 TTL | `3600` | ⚠️ |

---

## ⚠️ 주의사항

### ❌ 절대 하지 말 것
- `.env` 파일을 Git에 커밋하지 마세요
- 프로덕션에서 `MOCK_MODE=true` 사용하지 마세요
- Redis 비밀번호 없이 외부에 노출하지 마세요
- OpenAI API 키를 코드에 하드코딩하지 마세요

### ✅ 반드시 확인
- `.env` 파일이 `.gitignore`에 포함되어 있는지
- Health check 엔드포인트가 작동하는지 (`/health`)
- Redis 연결이 정상인지
- 벡터 파일이 존재하는지 (`vectors.json`)

---

## 🔧 추가 설정 (선택사항)

### 입력 검증
- ✅ 텍스트 길이 제한 (1000자) - 이미 구현됨
- ✅ k 값 범위 제한 (1-20) - 이미 구현됨

### 향후 추가 권장사항
- ⚠️ WebSocket 인증 구현
- ⚠️ Rate limiting 구현
- ⚠️ HTTPS/WSS 설정
- ⚠️ 로깅 개선

---

## 📚 더 자세한 정보

- **배포체크리스트.md** - 상세한 배포 가이드 (모든 항목 포함)
- **배포간단가이드.md** - 빠른 참조 가이드
- **env.production.example** - 환경 변수 템플릿

---

## 🆘 빠른 문제 해결

### 서버가 시작 안 됨
```bash
docker-compose logs server
```

### Redis 연결 실패
```bash
# 환경 변수 확인
docker-compose exec server env | grep REDIS
```

### Health check 실패
```bash
curl http://localhost:3000/health
```

---

## ✅ 배포 완료 확인

다음 명령어로 모든 것이 정상인지 확인하세요:

```bash
# 1. 컨테이너 상태
docker-compose ps

# 2. Health check
curl http://localhost:3000/health

# 3. WebSocket 테스트
node test_websocket.js

# 4. 로그 확인
docker-compose logs server | tail -20
```

모든 항목이 정상이면 배포 완료! 🎉

