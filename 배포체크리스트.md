# ğŸš€ í”„ë¡œë•ì…˜ ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

## ğŸ” 1. ë³´ì•ˆ ì„¤ì • (í•„ìˆ˜)

### 1.1 í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (.env íŒŒì¼)

í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë³€ìˆ˜ë“¤ì„ ì„¤ì •í•˜ì„¸ìš”:

```env
# ============================================
# í•„ìˆ˜ ì„¤ì •
# ============================================

# OpenAI API í‚¤ (ì‹¤ì œ ìœ íš¨í•œ í‚¤ ì‚¬ìš©)
OPENAI_API_KEY=sk-your-actual-api-key-here

# MOCK ëª¨ë“œ ë¹„í™œì„±í™” (í”„ë¡œë•ì…˜ì—ì„œëŠ” ë°˜ë“œì‹œ false!)
MOCK_MODE=false

# ì„œë²„ í¬íŠ¸
PORT=3000

# Redis ì—°ê²° (í”„ë¡œë•ì…˜ì—ì„œëŠ” ë¹„ë°€ë²ˆí˜¸ í•„ìˆ˜!)
REDIS_URL=redis://:your-redis-password@redis:6379

# ============================================
# OpenAI ëª¨ë¸ ì„¤ì •
# ============================================
OPENAI_MODEL=text-embedding-3-small
CHAT_MODEL=gpt-4o-mini

# ============================================
# ìºì‹œ ë° ê²€ìƒ‰ ì„¤ì •
# ============================================
# Redis ìºì‹œ TTL (ì´ˆ ë‹¨ìœ„, ê¸°ë³¸ 1ì‹œê°„)
CACHE_TTL_SECONDS=3600

# ìµœì†Œ ìœ ì‚¬ë„ ì„ê³„ê°’ (0.0 ~ 1.0)
# ì´ ê°’ë³´ë‹¤ ë‚®ìœ¼ë©´ LLM í´ë°± ì‚¬ìš©
MIN_SCORE_THRESHOLD=0.75

# ë²¡í„° ì–‘ìí™” ì„¤ì • (ìºì‹œ í‚¤ ìƒì„±ìš©)
QUANTIZE_DECIMALS=2
QUANTIZE_DIM_PREFIX=8

# ============================================
# ë³´ì•ˆ ì„¤ì • (ì¶”ê°€)
# ============================================
# í™˜ê²½ (production, staging, development)
NODE_ENV=production

# WebSocket ì¸ì¦ í† í° (ì„ íƒì‚¬í•­, êµ¬í˜„ í•„ìš”)
WS_AUTH_TOKEN=your-secure-random-token-here

# Rate limiting ì„¤ì • (ìš”ì²­/ë¶„)
RATE_LIMIT_PER_MINUTE=60
```

### 1.2 Redis ë³´ì•ˆ ì„¤ì •

í”„ë¡œë•ì…˜ì—ì„œëŠ” Redisì— ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤:

**docker-compose.ymlì—ì„œ Redis ì„¤ì • ì¶”ê°€:**

```yaml
redis:
  image: redis:7-alpine
  container_name: semantic-redis
  restart: always
  command: redis-server --requirepass ${REDIS_PASSWORD}
  environment:
    - REDIS_PASSWORD=${REDIS_PASSWORD}
  ports:
    - "127.0.0.1:6379:6379"  # ì™¸ë¶€ ë…¸ì¶œ ìµœì†Œí™”
  volumes:
    - redisdata:/data
```

`.env`ì— ì¶”ê°€:
```env
REDIS_PASSWORD=your-strong-redis-password-here
REDIS_URL=redis://:your-strong-redis-password-here@redis:6379
```

### 1.3 WebSocket ë³´ì•ˆ

í˜„ì¬ WebSocketì— ì¸ì¦ì´ ì—†ìŠµë‹ˆë‹¤. í”„ë¡œë•ì…˜ì—ì„œëŠ” ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¥¼ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤:

**ì˜µì…˜ 1: í† í° ê¸°ë°˜ ì¸ì¦ (ê¶Œì¥)**
- ì—°ê²° ì‹œ í† í° ê²€ì¦
- JWT ë˜ëŠ” API í‚¤ ì‚¬ìš©

**ì˜µì…˜ 2: Origin ê²€ì¦**
- í—ˆìš©ëœ ë„ë©”ì¸ì—ì„œë§Œ ì—°ê²° í—ˆìš©

**ì˜µì…˜ 3: IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸**
- íŠ¹ì • IPì—ì„œë§Œ ì—°ê²° í—ˆìš© (ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ìš©)

---

## ğŸ”§ 2. Docker ì„¤ì • ê°œì„ 

### 2.1 docker-compose.yml í”„ë¡œë•ì…˜ ë²„ì „

```yaml
version: "3.9"

services:
  server:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: semantic-autocomplete-server
    restart: always
    ports:
      - "${PORT:-3000}:3000"
    env_file:
      - .env
    environment:
      # í”„ë¡œë•ì…˜ì—ì„œëŠ” MOCK_MODE ì œê±° ë˜ëŠ” false
      - NODE_ENV=production
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379
    depends_on:
      - redis
    volumes:
      - ./vectors.json:/app/vectors.json:ro  # ì½ê¸° ì „ìš©
      - ./phrases.json:/app/phrases.json:ro
    # ë¦¬ì†ŒìŠ¤ ì œí•œ ì„¤ì •
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G
    # Health check ì¶”ê°€
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  redis:
    image: redis:7-alpine
    container_name: semantic-redis
    restart: always
    command: redis-server --requirepass ${REDIS_PASSWORD} --maxmemory 512mb --maxmemory-policy allkeys-lru
    environment:
      - REDIS_PASSWORD=${REDIS_PASSWORD}
    ports:
      - "127.0.0.1:6379:6379"  # ì™¸ë¶€ ë…¸ì¶œ ìµœì†Œí™”
    volumes:
      - redisdata:/data
    # ë¦¬ì†ŒìŠ¤ ì œí•œ
    deploy:
      resources:
        limits:
          memory: 512M
    healthcheck:
      test: ["CMD", "redis-cli", "--raw", "incr", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5

volumes:
  redisdata:
```

### 2.2 .dockerignore íŒŒì¼ ìƒì„±

```dockerignore
node_modules
npm-debug.log
.env
.env.*
*.log
.git
.gitignore
README.md
PROJECT_README.md
ë°°í¬ì²´í¬ë¦¬ìŠ¤íŠ¸.md
ë¹ ë¥¸ì‹œì‘ê°€ì´ë“œ.md
test_websocket.js
test_result.md
.docker
Dockerfile.dev
docker-compose.dev.yml
```

---

## âš™ï¸ 3. ì„œë²„ ì½”ë“œ ê°œì„  ì‚¬í•­

### 3.1 ì…ë ¥ ê²€ì¦ ê°•í™”

ë‹¤ìŒ ì‚¬í•­ë“¤ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤:

- [ ] í…ìŠ¤íŠ¸ ê¸¸ì´ ì œí•œ (ì˜ˆ: ìµœëŒ€ 1000ì)
- [ ] k ê°’ ë²”ìœ„ ì œí•œ (1 ~ 20)
- [ ] Rate limiting êµ¬í˜„
- [ ] ìš”ì²­ íƒ€ì„ì•„ì›ƒ ì„¤ì •
- [ ] WebSocket ì—°ê²° ìˆ˜ ì œí•œ

### 3.2 ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 

- [ ] Redis ì—°ê²° ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë¡œì§
- [ ] ë²¡í„° íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ì—ëŸ¬
- [ ] OpenAI API ì‹¤íŒ¨ ì‹œ ì ì ˆí•œ í´ë°±
- [ ] ì—ëŸ¬ ë¡œê·¸ êµ¬ì¡°í™”

### 3.3 Health Check ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€

```javascript
// server.jsì— ì¶”ê°€
fastify.get('/health', async (request, reply) => {
  const health = {
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    vectors: vectors.length,
    redis: 'unknown'
  };
  
  try {
    await redis.ping();
    health.redis = 'connected';
  } catch (e) {
    health.redis = 'disconnected';
    health.status = 'degraded';
  }
  
  return health;
});
```

---

## ğŸ“Š 4. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 4.1 ë¡œê¹… ê°œì„ 

- [ ] êµ¬ì¡°í™”ëœ ë¡œê¹… (JSON í˜•ì‹)
- [ ] ë¡œê·¸ ë ˆë²¨ ì„¤ì • (ERROR, WARN, INFO, DEBUG)
- [ ] ë¡œê·¸ ë¡œí…Œì´ì…˜ ì„¤ì •
- [ ] ë¯¼ê°í•œ ì •ë³´ ì œê±° (API í‚¤ ë“±)

### 4.2 ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­

ë‹¤ìŒ ë©”íŠ¸ë¦­ë“¤ì„ ìˆ˜ì§‘í•´ì•¼ í•©ë‹ˆë‹¤:

- [ ] WebSocket ì—°ê²° ìˆ˜
- [ ] ì¿¼ë¦¬ ì²˜ë¦¬ ì‹œê°„
- [ ] ìºì‹œ íˆíŠ¸ìœ¨
- [ ] OpenAI API í˜¸ì¶œ íšŸìˆ˜ ë° ë¹„ìš©
- [ ] ì—ëŸ¬ ë°œìƒë¥ 
- [ ] ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰

---

## ğŸš¦ 5. ì„±ëŠ¥ ìµœì í™”

### 5.1 ë²¡í„° ê²€ìƒ‰ ìµœì í™”

í˜„ì¬ëŠ” brute-force ê²€ìƒ‰ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ë²¡í„°ê°€ ë§ì•„ì§€ë©´ (1000ê°œ ì´ìƒ) ë‹¤ìŒì„ ê³ ë ¤:

- [ ] FAISS ë¼ì´ë¸ŒëŸ¬ë¦¬ ë„ì…
- [ ] Milvus/Pinecone ê°™ì€ ë²¡í„° DB ì‚¬ìš©
- [ ] ì¸ë±ìŠ¤ ê¸°ë°˜ ê²€ìƒ‰

### 5.2 ë¦¬ì†ŒìŠ¤ ìµœì í™”

- [ ] ë²¡í„° íŒŒì¼ ë©”ëª¨ë¦¬ ìµœì í™”
- [ ] Redis ë©”ëª¨ë¦¬ ì œí•œ ì„¤ì •
- [ ] Node.js ë©”ëª¨ë¦¬ ì œí•œ ì„¤ì •
- [ ] ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ì œí•œ

---

## ğŸ”„ 6. ë°°í¬ ì „ í…ŒìŠ¤íŠ¸

### 6.1 í•„ìˆ˜ í…ŒìŠ¤íŠ¸

```bash
# 1. ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸
npm test  # í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ í•„ìš” ì‹œ ì¶”ê°€

# 2. Docker ì´ë¯¸ì§€ ë¹Œë“œ í…ŒìŠ¤íŠ¸
docker-compose build

# 3. í”„ë¡œë•ì…˜ í™˜ê²½ ë³€ìˆ˜ë¡œ í…ŒìŠ¤íŠ¸
MOCK_MODE=false docker-compose up

# 4. Health check í…ŒìŠ¤íŠ¸
curl http://localhost:3000/health

# 5. WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸
node test_websocket.js

# 6. ë¶€í•˜ í…ŒìŠ¤íŠ¸ (ì„ íƒì‚¬í•­)
# ì—¬ëŸ¬ ë™ì‹œ ì—°ê²° í…ŒìŠ¤íŠ¸
```

### 6.2 ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] OpenAI API í‚¤ê°€ ìœ íš¨í•œì§€ í™•ì¸
- [ ] Redis ì—°ê²°ì´ ì •ìƒì¸ì§€ í™•ì¸
- [ ] ë²¡í„° íŒŒì¼ì´ ë¡œë“œë˜ëŠ”ì§€ í™•ì¸
- [ ] WebSocket ì—°ê²°ì´ ì •ìƒì¸ì§€ í™•ì¸
- [ ] ìºì‹±ì´ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
- [ ] LLM í´ë°±ì´ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
- [ ] ì—ëŸ¬ ì²˜ë¦¬ê°€ ì ì ˆí•œì§€ í™•ì¸

---

## ğŸ”’ 7. ë³´ì•ˆ ì ê²€

### 7.1 í•„ìˆ˜ ë³´ì•ˆ í•­ëª©

- [ ] `.env` íŒŒì¼ì´ `.gitignore`ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
- [ ] Docker ì´ë¯¸ì§€ì— ë¯¼ê°í•œ ì •ë³´ê°€ í¬í•¨ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
- [ ] Redis í¬íŠ¸ê°€ ì™¸ë¶€ì— ë…¸ì¶œë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
- [ ] WebSocketì— ì¸ì¦ì´ êµ¬í˜„ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (ê¶Œì¥)
- [ ] HTTPS/WSS ì‚¬ìš© (í”„ë¡œë•ì…˜ í•„ìˆ˜)
- [ ] Rate limiting êµ¬í˜„
- [ ] ì…ë ¥ ê²€ì¦ ë° sanitization

### 7.2 .gitignore í™•ì¸

```
.env
.env.*
*.log
node_modules/
vectors.json
test_websocket.js
.DS_Store
```

---

## ğŸ“ 8. í”„ë¡œë•ì…˜ ë°°í¬ ë‹¨ê³„

### 8.1 ë°°í¬ ì „ ìµœì¢… ì²´í¬

```bash
# 1. ì½”ë“œ ì»¤ë°‹
git add .
git commit -m "Prepare for production deployment"

# 2. .env íŒŒì¼ ìƒì„± (ì„œë²„ì—ì„œ)
# ìœ„ì˜ í™˜ê²½ ë³€ìˆ˜ í…œí”Œë¦¿ ì°¸ê³ 

# 3. ë²¡í„° íŒŒì¼ í™•ì¸
ls -lh vectors.json
# íŒŒì¼ í¬ê¸° í™•ì¸

# 4. Docker ì´ë¯¸ì§€ ë¹Œë“œ
docker-compose build

# 5. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
docker-compose up -d
# ë¡œê·¸ í™•ì¸
docker-compose logs -f server

# 6. Health check
curl http://localhost:3000/health

# 7. WebSocket í…ŒìŠ¤íŠ¸
node test_websocket.js
```

### 8.2 ë°°í¬ ëª…ë ¹ì–´

```bash
# í”„ë¡œë•ì…˜ ì„œë²„ì—ì„œ
cd /path/to/EPEPServer

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cp .env.production .env
# .env íŒŒì¼ í¸ì§‘í•˜ì—¬ ì‹¤ì œ ê°’ ì…ë ¥

# Docker Composeë¡œ ì‹¤í–‰
docker-compose -f docker-compose.yml up -d

# ë¡œê·¸ ëª¨ë‹ˆí„°ë§
docker-compose logs -f

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose ps
```

---

## ğŸ”§ 9. í”„ë¡œë•ì…˜ìš© docker-compose.prod.yml ì˜ˆì‹œ

í”„ë¡œë•ì…˜ ì „ìš© ì„¤ì • íŒŒì¼ì„ ë³„ë„ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```yaml
# docker-compose.prod.yml
version: "3.9"

services:
  server:
    build: .
    restart: always
    env_file:
      - .env
    environment:
      - NODE_ENV=production
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  redis:
    image: redis:7-alpine
    restart: always
    command: redis-server --requirepass ${REDIS_PASSWORD} --maxmemory 512mb
    ports:
      - "127.0.0.1:6379:6379"

volumes:
  redisdata:
```

ì‚¬ìš©:
```bash
docker-compose -f docker-compose.prod.yml up -d
```

---

## âœ… ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½

### í•„ìˆ˜ ì‚¬í•­
- [ ] `.env` íŒŒì¼ ìƒì„± ë° ëª¨ë“  í•„ìˆ˜ ë³€ìˆ˜ ì„¤ì •
- [ ] `MOCK_MODE=false` ì„¤ì •
- [ ] ìœ íš¨í•œ OpenAI API í‚¤ ì„¤ì •
- [ ] Redis ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
- [ ] Health check ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
- [ ] ì…ë ¥ ê²€ì¦ êµ¬í˜„
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
- [ ] `.gitignore`ì— `.env` í¬í•¨ í™•ì¸

### ê¶Œì¥ ì‚¬í•­
- [ ] WebSocket ì¸ì¦ êµ¬í˜„
- [ ] Rate limiting êµ¬í˜„
- [ ] ë¡œê¹… ê°œì„ 
- [ ] ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [ ] HTTPS/WSS ì‚¬ìš©
- [ ] ë¦¬ì†ŒìŠ¤ ì œí•œ ì„¤ì •
- [ ] Docker ì´ë¯¸ì§€ ìµœì í™”

### ì„ íƒ ì‚¬í•­
- [ ] ë²¡í„° DB ë„ì… (FAISS, Milvus ë“±)
- [ ] ë¶€í•˜ í…ŒìŠ¤íŠ¸
- [ ] CI/CD íŒŒì´í”„ë¼ì¸ ì„¤ì •
- [ ] ë°±ì—… ì „ëµ ìˆ˜ë¦½

---

## ğŸ†˜ ë¬¸ì œ ë°œìƒ ì‹œ ëŒ€ì‘

### ì„œë²„ê°€ ì‹œì‘ë˜ì§€ ì•Šì„ ë•Œ
1. ë¡œê·¸ í™•ì¸: `docker-compose logs server`
2. í™˜ê²½ ë³€ìˆ˜ í™•ì¸: `.env` íŒŒì¼ ê²€ì¦
3. Redis ì—°ê²° í™•ì¸: `docker-compose logs redis`
4. ë²¡í„° íŒŒì¼ í™•ì¸: `vectors.json` ì¡´ì¬ ë° í˜•ì‹ ê²€ì¦

### WebSocket ì—°ê²°ì´ ì•ˆ ë  ë•Œ
1. í¬íŠ¸ í™•ì¸: `netstat -tlnp | grep 3000`
2. ë°©í™”ë²½ í™•ì¸
3. í”„ë¡ì‹œ ì„¤ì • í™•ì¸ (Nginx, Cloudflare ë“±)
4. SSL/TLS ì¸ì¦ì„œ í™•ì¸ (WSS ì‚¬ìš© ì‹œ)

### ì„±ëŠ¥ ë¬¸ì œ
1. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸: `docker stats`
2. Redis ìºì‹œ íˆíŠ¸ìœ¨ í™•ì¸
3. ë²¡í„° ê²€ìƒ‰ ì‹œê°„ ì¸¡ì •
4. OpenAI API ì‘ë‹µ ì‹œê°„ í™•ì¸

